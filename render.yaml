services:
  - type: web
    name: waterbot-backend
    runtime: docker
    dockerfilePath: ./Dockerfile
    dockerContext: .
    plan: starter  # Change to 'standard' or 'pro' for production
    envVars:
      - key: OPENAI_API_KEY
        sync: false  # Set manually in Render dashboard - REQUIRED for RAG loading during build
      - key: MESSAGES_TABLE
        sync: false
      - key: TRANSCRIPT_BUCKET_NAME
        sync: false
      # PostgreSQL (messages + RAG). Use either DATABASE_URL or DB_*.
      - key: DATABASE_URL
        sync: false
      - key: DB_HOST
        sync: false
      - key: DB_USER
        sync: false
      - key: DB_PASSWORD
        sync: false
      - key: DB_NAME
        sync: false
    # Render automatically sets PORT environment variable
    # Build args for RAG loading during Docker build
    buildCommand: docker build --platform linux/amd64 --build-arg OPENAI_API_KEY=$OPENAI_API_KEY -t waterbot-backend .
    healthCheckPath: /

